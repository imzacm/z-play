<html lang="en">
<head>
    <title>Z-Play</title>

    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden; /* Prevents scrollbars on the body */
        }

        h1 {
            margin: 10px;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        #container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-color: #000; /* Black background for media */
        }

        #container img, #container video {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Keeps aspect ratio while fitting */
        }

        button {
            height: 50px;
            width: 100%;
            flex-shrink: 0;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>Playing: <span id="playing-text"></span></h1>
<div id="container"></div>
<button onclick="nextFile()">Next</button>

<script>
    let playingText
    let container

    const history = []

    document.addEventListener('DOMContentLoaded', () => {
        playingText = document.getElementById('playing-text')
        container = document.getElementById('container')
    })

    async function nextFile() {
        const path = await fetch('random').then(r => r.text())
        console.log(path)
        const extension = path.split('.').pop().toLowerCase()

        const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg', 'tiff']
        const videoExtensions = ['mp4', 'mkv', 'webm', 'avi', 'mov', 'wmv', 'flv', 'mpeg']
        const audioExtensions = ['mp3', 'wav', 'ogg', 'm4a', 'flac', 'aac']

        if (container.children.length !== 0) {
            container.removeChild(container.children[0])
        }

        let element
        if (imageExtensions.includes(extension)) {
            element = document.createElement('img')
        } else if (videoExtensions.includes(extension)) {
            element = document.createElement('video')
            element.controls = true
        } else if (audioExtensions.includes(extension)) {
            element = document.createElement('audio')
            element.controls = true
        } else {
            console.error(`Unsupported file extension: ${extension}`)
            await nextFile()
            return
        }

        playingText.innerText = path

        if (path.startsWith('/')) {
            element.src = `files${path}`
        } else {
            element.src = `files/${path}`
        }

        element.addEventListener('error', () => nextFile(), {once: true})
        element.addEventListener('ended', () => nextFile(), {once: true})

        container.appendChild(element)
    }
</script>
</body>
</html>
